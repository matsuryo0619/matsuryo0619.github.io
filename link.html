<!DOCTYPE html>
<html lang='ja'>
  <head>
    <title>スゴスク! - リンク</title>
    <meta charset='UTF-8'>
    <link rel='stylesheet' href='border.css'>
    <style>
      button {
        display: inline-block;
      }

      #link_div {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

    </style>
    <script src='context.js' defer></script>
  </head>
  <body>
    <div id='link_div'>
    <h1>以下のリンクを開きます｡よろしいですか?</h1>
    <p id='warning'>当サイトはリンク先の安全性を保証しません。リンク先の閲覧・利用は自己責任でお願いします。</p>
    <p id='link'></p>
    <br>
    <button id='none'>いいえ</button>
    <button id='yes'>はい</button>
    </div>
    <script>
      const urlParams = new URLSearchParams(window.location.search);
      const warning = document.getElementById('warning');

      // 'link' パラメータを取得
      let link = urlParams.get('link');
      link = decodeURIComponent(link);
      document.getElementById('link').textContent = link;

      let type = urlParams.get('type');
      if (type === 'normal') {
        warning.style.display = 'none';
      } else {
        warning.style.display = 'block';
        if (type === 'comment') warningChange('このリンクはコメントに貼ってあったものです｡ 安全ではない可能性があります。', 'red', link);
      }

      function warningChange(text, color, link) {
        warning.innerHTML = `${text.replace(/\n/g, '<br>')}<br>また、当サイトはリンク先の安全性を保証しません。リンク先の閲覧・利用は自己責任でお願いします。`;
        if (link.startsWith('http://')) warning.innerHTML += `<br>リンク先は､<a href='https://support.google.com/chrome/answer/95617?hl=ja&co=GENIE.Platform%3DDesktop&sjid=14465702384509331895-NC#zippy=%2C%E4%BF%9D%E8%AD%B7%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84%E9%80%9A%E4%BF%A1%E3%81%BE%E3%81%9F%E3%81%AF%E5%8D%B1%E9%99%BA%2C%E6%83%85%E5%A0%B1%E3%81%BE%E3%81%9F%E3%81%AF%E4%BF%9D%E8%AD%B7%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84%E9%80%9A%E4%BF%A1:~:text=%E3%81%8C%E3%81%82%E3%82%8A%E3%81%BE%E3%81%99%E3%80%82-,%E4%BF%9D%E8%AD%B7%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84%E9%80%9A%E4%BF%A1%E3%80%81%E3%81%BE%E3%81%9F%E3%81%AF%E5%8D%B1%E9%99%BA,-%E3%81%93%E3%81%AE%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%A7%E3%81%AF' target='_blank'>
        保護されていない通信</a>となっています あらかじめご確認ください`;
        warning.style.color = color;
      }

      // ボタンのクリックイベント設定
      const buttons = document.querySelectorAll('button');
      buttons.forEach(btn => {
        btn.addEventListener('click', function() {
          if (this.id === "none") {
            window.close();  // ウィンドウを閉じる
          } else if (this.id === "yes") {
            window.location.href = link;  // 'link' のURLに遷移
          }
        });
      });  

    </script>
  </body>
</html>
